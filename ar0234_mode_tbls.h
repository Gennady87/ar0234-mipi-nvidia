/* SPDX-License-Identifier: GPL-2.0 */
/*
 * ar0234_mode_tbls.h - ar0234 sensor driver
 *
 * Copyright (c) 2016-2023 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
 * Copyright (c) 2026, UAB Kurokesu. All rights reserved.
 */

#ifndef __AR0234_MODE_TBLS_H__
#define __AR0234_MODE_TBLS_H__

#include <media/camera_common.h>
#include <linux/miscdevice.h>

#define AR0234_TABLE_WAIT_MS 0
#define AR0234_TABLE_END 1
#define AR0234_WAIT_MS 1

/* clang-format off */
#define AR0234_REG16(_address, _val) \
	{ (_address), (((_val) >> 8) & 0xFF) }, \
	{ ((_address) + 1), (_val) & 0xFF }
/* clang-format on */

#define AR0234_REG_CHIP_ID 0x3000
#define AR0234_REG_MODE_SELECT 0x301C
#define AR0234_REG_VT_PIX_CLK_DIV 0x302A
#define AR0234_REG_VT_SYS_CLK_DIV 0x302C
#define AR0234_REG_PRE_PLL_CLK_DIV 0x302E
#define AR0234_REG_PLL_MULTIPLIER 0x3030
#define AR0234_REG_OP_PIX_CLK_DIV 0x3036
#define AR0234_REG_OP_SYS_CLK_DIV 0x3038
#define AR0234_REG_DATA_FORMAT_BITS 0x31AC
#define AR0234_REG_FRAME_PREAMBLE 0x31B0
#define AR0234_REG_LINE_PREAMBLE 0x31B2
#define AR0234_REG_MIPI_TIMING_0 0x31B4
#define AR0234_REG_MIPI_TIMING_1 0x31B6
#define AR0234_REG_MIPI_TIMING_2 0x31B8
#define AR0234_REG_MIPI_TIMING_3 0x31BA
#define AR0234_REG_MIPI_TIMING_4 0x31BC
#define AR0234_REG_MIPI_CNTRL 0x3354
#define AR0234_REG_SERIAL_FORMAT 0x31AF

#define AR0234_REG_DIGITAL_TEST 0x30B0
#define AR0234_REG_DATAPATH_SELECT 0x306E
#define AR0234_REG_OPERATION_MODE_CTRL 0x3082
#define AR0234_REG_COMPANDING 0x31D0
#define AR0234_REG_SEQ_CTRL_PORT 0x3088
#define AR0234_REG_SEQ_DATA_PORT 0x3086
#define AR0234_REG_PIX_DEF_ID 0x31E0
#define AR0234_REG_DELTA_DK_CONTROL 0x3180
#define AR0234_REG_AE_LUMA_TARGET 0x3102

#define AR0234_REG_Y_ADDR_START 0x3002
#define AR0234_REG_X_ADDR_START 0x3004
#define AR0234_REG_Y_ADDR_END 0x3006
#define AR0234_REG_X_ADDR_END 0x3008
#define AR0234_REG_X_ODD_INC 0x30A2
#define AR0234_REG_Y_ODD_INC 0x30A6

#define AR0234_REG_RESET 0x301A

#define AR0234_REG_MFR_30BA 0x30BB

#define AR0234_REG_FRAME_LENGTH_LINES 0x300A

#define AR0234_MFR_30BA_GAIN_BITS(_val) (0x20 | (_val))

#define ar0234_reg struct reg_8

/* AR0234 Start Streaming TODO: tables not necessary? */
static ar0234_reg ar0234_start[] = {
	{ AR0234_REG_MODE_SELECT, 0x01 },
	{ AR0234_TABLE_END, 0x00 },
};

/* AR0234 Stop Streaming TODO: tables not necessary? */
static ar0234_reg ar0234_stop[] = {
	{ AR0234_REG_MODE_SELECT, 0x00 },
	{ AR0234_TABLE_END, 0x00 },
};

/* AR0234 PLL configs */
static ar0234_reg ar0234_pll_config_24_450_10bit[] = {
	{ AR0234_TABLE_WAIT_MS, AR0234_WAIT_MS * 20 },
	AR0234_REG16(AR0234_REG_RESET, 0x0001),
	{ AR0234_TABLE_WAIT_MS, AR0234_WAIT_MS * 200 },
	AR0234_REG16(AR0234_REG_RESET, 0x2058),
	AR0234_REG16(AR0234_REG_VT_PIX_CLK_DIV, 0x0005),
	AR0234_REG16(AR0234_REG_VT_SYS_CLK_DIV, 0x0001),
	AR0234_REG16(AR0234_REG_PRE_PLL_CLK_DIV, 0x0008),
	AR0234_REG16(AR0234_REG_PLL_MULTIPLIER, 0x0096),
	AR0234_REG16(AR0234_REG_OP_PIX_CLK_DIV, 0x000A),
	AR0234_REG16(AR0234_REG_OP_SYS_CLK_DIV, 0x0001),
	AR0234_REG16(AR0234_REG_FRAME_PREAMBLE, 0X0082),
	AR0234_REG16(AR0234_REG_LINE_PREAMBLE, 0X005C),
	AR0234_REG16(AR0234_REG_MIPI_TIMING_0, 0X4248),
	AR0234_REG16(AR0234_REG_MIPI_TIMING_1, 0X4258),
	AR0234_REG16(AR0234_REG_MIPI_TIMING_2, 0X904B),
	AR0234_REG16(AR0234_REG_MIPI_TIMING_3, 0X030B),
	AR0234_REG16(AR0234_REG_MIPI_TIMING_4, 0X0D89),
	AR0234_REG16(AR0234_REG_MIPI_CNTRL, 0x002B),
	AR0234_REG16(AR0234_REG_DATA_FORMAT_BITS, 0x0A0A),
	{ AR0234_TABLE_END, 0x00 },
};

static ar0234_reg ar0234_pixclk_45mhz_mfr_settings[] = {
	AR0234_REG16(AR0234_REG_SEQ_CTRL_PORT, 0x81BA),
	AR0234_REG16(AR0234_REG_SEQ_DATA_PORT, 0x3D02),
	{ AR0234_TABLE_END, 0x00 },
};

/* AR0234 Common Mode */
static ar0234_reg ar0234_mode_common[] = {
	AR0234_REG16(AR0234_REG_DIGITAL_TEST, 0x0028),
	AR0234_REG16(AR0234_REG_DATAPATH_SELECT, 0x9010),
	AR0234_REG16(AR0234_REG_OPERATION_MODE_CTRL, 0x0003),
	AR0234_REG16(AR0234_REG_COMPANDING, 0x0000),
	AR0234_REG16(AR0234_REG_SEQ_CTRL_PORT, 0x8050),
	AR0234_REG16(AR0234_REG_SEQ_DATA_PORT, 0x9237),
	AR0234_REG16(0x3096, 0x0280),
	AR0234_REG16(AR0234_REG_PIX_DEF_ID, 0x0003),
	AR0234_REG16(0x3F4C, 0x121F),
	AR0234_REG16(0x3F4E, 0x121F),
	AR0234_REG16(0x3F50, 0x0B81),
	AR0234_REG16(0x3ED2, 0xFA96),
	AR0234_REG16(AR0234_REG_DELTA_DK_CONTROL, 0x824F),
	AR0234_REG16(0x3ECC, 0x0C42),
	AR0234_REG16(0x3ECC, 0x0C42),
	AR0234_REG16(0x30F0, 0x2283),
	AR0234_REG16(AR0234_REG_AE_LUMA_TARGET, 0x5000),
	{ AR0234_TABLE_END, 0x00 },
};

/* AR0234 1920x1200 2-lane mode */
static ar0234_reg ar0234_mode_1920x1200[] = {
	AR0234_REG16(AR0234_REG_Y_ADDR_START, 0x0008),
	AR0234_REG16(AR0234_REG_X_ADDR_START, 0x0008),
	AR0234_REG16(AR0234_REG_Y_ADDR_END, 0x04B7),
	AR0234_REG16(AR0234_REG_X_ADDR_END, 0x0787),
	AR0234_REG16(AR0234_REG_X_ODD_INC, 0x0001),
	AR0234_REG16(AR0234_REG_Y_ODD_INC, 0x0001),
	AR0234_REG16(AR0234_REG_FRAME_LENGTH_LINES, 2450),
	{ AR0234_TABLE_END, 0x00 },
};

static ar0234_reg ar0234_mode_test_pattern[] = {
	/* TODO */
};

enum { AR0234_MODE_1920X1200,
       AR0234_MODE_COMMON,
       AR0234_START_STREAM,
       AR0234_STOP_STREAM,
       AR0234_MODE_TEST_PATTERN,
       AR0234_PLL_CONFIG_24_450_10BIT,
	   AR0234_PIXCLK_45MHZ_MFR_SETTINGS,
};

static ar0234_reg *mode_table[] = {
	[AR0234_MODE_1920X1200] = ar0234_mode_1920x1200,
	[AR0234_MODE_COMMON] = ar0234_mode_common,
	[AR0234_START_STREAM] = ar0234_start,
	[AR0234_STOP_STREAM] = ar0234_stop,
	[AR0234_MODE_TEST_PATTERN] = ar0234_mode_test_pattern,
	[AR0234_PLL_CONFIG_24_450_10BIT] = ar0234_pll_config_24_450_10bit,
	[AR0234_PIXCLK_45MHZ_MFR_SETTINGS] = ar0234_pixclk_45mhz_mfr_settings,
};

static const int ar0234_30fps[] = {
	30,
};

/*
 * WARNING: frmfmt ordering needs to match mode definition in
 * device tree!
 */
static const struct camera_common_frmfmt ar0234_frmfmt[] = {
	{ { 1920, 1200 }, ar0234_30fps, 1, 0, AR0234_MODE_1920X1200 },
};

#endif /* __AR0234_MODE_TBLS_H__ */
